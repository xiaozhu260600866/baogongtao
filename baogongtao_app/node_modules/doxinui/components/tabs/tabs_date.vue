<template>
	<view class="dxi-date-nav">
		<view class="dxi-nav" :class="[isFixed?'dxi-nav-fixed':'dxi-nav-relative',myclass]" :style="{padding:padding,top:isFixed?top*2+'rpx':'auto',background:bgColor,zIndex:zIndex+1}">
			<view class="dxi-nav-item" :style="{background:itemBg,borderRadius:borderR*2+'rpx'}">
				<view class="dxi-nav-tabs" :class="{'dxi-nav-order':v.orderTime}" :style="{fontSize:size*2+'rpx',color:currentTab==index?curColor:color,lineHeight:lineH*2+'rpx',background:currentTab==index?curBg:'',borderRadius:borderR*2+'rpx'}" v-for="(v,index) in tabs" :key="index" @tap.stop="swichTabs(index)">{{ v.name }}</view>
			</view>
		</view>
		<view class="dxi-nav-order" :class="{'show_date':showDate}" :style="{top:orderTop*2+'rpx',zIndex:zIndex}">
			<view class="order-left">
			<picker class="order-date" mode="date" :value="start_date" start="1900-01-01" end="2099-12-31" @change="startDate">
				<view class="picker">{{start_date}}</view>
			</picker>
			<view class="and">-</view>
			<picker class="order-date" mode="date" :value="end_date" start="1900-01-01" end="2099-12-31" @change="endDate">
				<view class="picker">{{end_date}}</view>
			</picker>
			</view>
			<view class="order-right">
				<dx-button :type="btnType" size="medium" @click="search" block>搜索</dx-button>
			</view>
		</view>
	</view>
</template>

<script>
import dxButton from "doxinui/components/button/button"
 export default{
	components:{dxButton},
	props:{
		tabs: {
			type: Array,
			default () {
				return [
					{name: "今日",prop:'today'},
					{name: "昨日",prop:'yesterday'},
					{name: "本月",prop:'thismonth'},
					{name: "上月",prop:'prevmonth'},
					{name: "时间",type:"date"},
				]
			}
		},
		myclass:{
			type:String,
			default:''
		},
		padding:{
			type:String,
			default:'16rpx 20rpx'
		},
		bgColor:{
			type:String,
			default:'#FFFFFF'
		},
		itemBg:{
			type:String,
			default:'#F5F5F5'
		},
		borderR:{
			type:Number,
			default: 17
		},
		isFixed: {
			type: Boolean,
			default: false
		},
		top: {
			type: Number,
			default: 0
		},
		size:{
			type:Number,
			default: 14
		},
		color:{
			type:String,
			default:'#999'
		},
		lineH:{
			type:Number,
			default: 34
		},
		curColor:{
			type:String,
			default: '#fff'
		},
		curBg:{
			type: String,
			default:'#409eff'
		},
		orderTop: {
			type: Number,
			default: 50
		},
		btnType:{
			type: String,
			default: 'primary'
		},
		zIndex:{
			type: Number,
			default: 100
		}
	},
	data() {
		return {
			//ruleform:{}
			otherTime: true,
			currentTab: 0, //预设当前项的值
			start_date: this.formatDate(new Date()),
			end_date: this.formatDate(new Date()),
			item:{},
			showDate:false,
		}
	},
	methods:{
		search(){
			this.showDate = false;
			this.$emit("change",{start_date:this.start_date,end_date:this.end_date})
		},
		startDate: function(e) {
			console.log('picker发送选择改变，携带值为', e.detail.value)
			this.start_date = e.detail.value;
		},
		endDate: function(e) {
			console.log('picker发送选择改变，携带值为', e.detail.value)
			this.end_date = e.detail.value;
		},
		formatDate(obj,type){
			let month = obj.getMonth()+1;
			month = month <10 ? "0"+month : month;
			let date =  obj.getDate() < 10 ? "0"+obj.getDate() : obj.getDate();
			if(!type) return  obj.getFullYear() + '-' + month + '-' + date
			return obj.getFullYear() + '-' + month + '-' + date + ' ' + obj.getHours() + ':' + obj.getMinutes();
		},
		swichTabs: function(index) {
			console.log(index);
			this.item = this.tabs[index]
			console.log(this.item);
			this.currentValue = this.item.value;
			this.currentTab = index;
			if(this.item.type == 'date'){
				
				this.showDate = true;
			}else{
				this.showDate = false;
				this.$emit('change',this.item);
			}
			
			
		},
		
		
	 }
 }
</script>

<style>
.dxi-date-nav{position: relative;}
.dxi-nav{position: relative;}
.dxi-nav-item{display: flex;width: 100%;position: relative;}
.dxi-nav-item .dxi-nav-tabs{width: 100%;text-align: center;}
.dxi-nav-item .cur{background: #409eff;color: #fff;border-radius: 34upx;}
.dxi-nav-fixed {position: fixed;left: 0;}

.dxi-nav-order{display: flex;align-items: center;padding: 24upx;position: absolute;top: 100upx;width: 100%;left: 0;background-color: #fff;border-top: 1upx #eee solid;box-shadow: 0 4px 8px 0 hsla(0,6%,58%,.3);transition: all 0.3s ease-in-out;transform: translate3d(0, -100%, 0);visibility: hidden;transform-origin: center;}
.show_date{transform: translate3d(0, 0, 0);visibility: visible;}
.dxi-nav-order .order-left{display: flex;align-items: center;flex: 1;}
.dxi-nav-order .order-date{padding: 0 20upx;background-color: #fff;border-radius: 12upx;border: 2upx #e1e1e1 solid;width: 100%;height: 72upx;line-height: 72upx;text-align: center;font-family: Arial;color: #666;}
.dxi-nav-order .and{width: 60upx;flex: 0;margin: 0 20upx;color: #999;}
.dxi-nav-order .order-right{margin-left: 30upx;}
</style>