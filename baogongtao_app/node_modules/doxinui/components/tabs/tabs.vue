<template>
	<view>
		<input class="dx-input" :value="currentValue"  hidden/>
		<view class="dxi-tabs-view" :class="[isFixed?'dxi-tabs-fixed':'dxi-tabs-relative',unlined?'dxi-unlined':'']" :style="{height:height+'rpx',padding:`0 ${padding}rpx`,background:bgColor,top:isFixed?top+'px':'auto',zIndex:zIndex}">
			<view v-for="(item,index) in tabs" :key="index" class="dxi-tabs-item" :style="{width:itemWidth}" @tap.stop="swichTabs(index)">
				<view class="dxi-tabs-title" :class="{'dxi-tabs-active':currentTab==index,'dxi-tabs-disabled':item.disabled}" :style="{color:currentTab==index?selectedColor:color,fontSize:currentTab==index?selectedSize+'rpx':size+'rpx',lineHeight:currentTab==index?selectedSize+'rpx':size+'rpx',fontWeight:bold && currentTab==index?'bold':'normal'}">
					<text>{{item.name}}</text>
					<text class="Arial" v-if="item.num">({{item.num}})</text>
				</view>
			</view>
			<view class="dxi-tabs-slider" :style="{transform:'translateX('+scrollLeft+'px)',width:sliderWidth+'rpx',height:
		sliderHeight+'rpx',borderRadius:sliderRadius,bottom:bottom,background:sliderBgColor,marginBottom:bottom=='50%'?('-'+sliderHeight/2+'rpx'):0}"></view>
		</view>
	<slot></slot>
	</view>
</template>

<script>
	export default {
		name: "dxiTabs",
		props: {
			//标签页
			tabs: {
				type: Array,
				default () {
					return []
				}
			},
			//rpx
			height: {
				type: Number,
				default: 80
			},
			//rpx 只对左右padding起作用，上下为0
			padding: {
				type: Number,
				default: 30
			},
			//背景色
			bgColor: {
				type: String,
				default: "#FFFFFF"
			},
			//是否固定
			isFixed: {
				type: Boolean,
				default: false
			},
			//px
			top: {
				type: Number
					// #ifndef H5
					,
				default: 0
					// #endif
					// #ifdef H5
					,
				default: 44
				// #endif
			},
			//是否去掉底部线条
			unlined: {
				type: Boolean,
				default: false
			},
			//滑块宽度
			sliderWidth: {
				type: Number,
				default: 68
			},
			//滑块高度
			sliderHeight: {
				type: Number,
				default: 6
			},
			//滑块背景颜色
			sliderBgColor: {
				type: String,
				default: "#5677fc"
			},
			sliderRadius:{
				type: String,
				default: "50rpx"
			},
			value: {
				type: String,
				default: ''
			},
			//滑块bottom
			bottom: {
				type: String,
				default: "0"
			},
			//字体颜色
			color: {
				type: String,
				default: "#666"
			},
			//选中后字体颜色
			selectedColor: {
				type: String,
				default: "#5677fc"
			},
			//字体大小
			size: {
				type: Number,
				default: 28
			},
			selectedSize:{
				type: Number,
				default: 28
			},
			//选中后 是否加粗 ，未选中则无效
			bold: {
				type: Boolean,
				default: false
			},
			zIndex:{
				type: Number,
				default: 99
			}
		},
		watch: {
			currentTab() {
				this.checkCor();
			}
		},
		created() {
			setTimeout(() => {
				// 高度自适应
				uni.getSystemInfo({
					success: (res) => {
						this.winWidth = res.windowWidth;
						this.checkCor()
					}
				});
				let ratio =  100 / this.tabs.length ;
				this.itemWidth = ratio + "%";
				if(this.tabs.length && this.value && !this.init){
					
					this.tabs.forEach((v,key)=>{
						if(this.value == v.value){
							this.currentTab = key;
							this.init = true;
						}
					});
				}
			}, 50);
		},
		data() {
			return {
				winWidth: 0,
				scrollLeft: 0,
				itemWidth:"25%",
				currentTab:0,
				init:false,
			};
		},
		computed: {
			currentValue: {
				// 动态计算currentValue的值
				get: function() {
					return this.value;
				},
				set: function(val) {
					this.$emit('input', val);
				}
			}
		},
		methods: {
			checkCor: function() {
				let tabsNum = this.tabs.length
				let padding = this.winWidth / 750 * this.padding
				let width = this.winWidth - padding * 2
				let left = (width / tabsNum - (this.winWidth / 750 * this.sliderWidth)) / 2 + padding
				let scrollLeft = left
				if (this.currentTab > 0) {
					scrollLeft = scrollLeft + (width / tabsNum) * this.currentTab
				}
				this.scrollLeft = scrollLeft
			},
			// 点击标题切换当前页时改变样式
			swichTabs: function(index) {
				let item = this.tabs[index]
				
				console.log(this.currentValue);
				if (item && item.disabled) return;
				if (this.currentTab == index) {
					return false;
				} else {
					this.currentValue = item.value;
					this.currentTab = index;
					this.$emit("change", {
						index: Number(index)
					})
				}
			}
		}}
</script>

<style>
.dxi-tabs-view {width: 100%;box-sizing: border-box;display: flex;align-items: center;justify-content: space-between;}
.dxi-tabs-relative {position: relative;}
.dxi-tabs-fixed {position: fixed;left: 0;}
.dxi-tabs-fixed::before,
.dxi-tabs-relative::before {content: '';position: absolute;border-bottom: 1px solid #eaeef1;-webkit-transform: scaleY(0.5);transform: scaleY(0.5);bottom: 0;right: 0;left: 0;}
.dxi-unlined::before {border-bottom: 0 !important}
.dxi-tabs-item {display: flex;align-items: center;justify-content: center;}
.dxi-tabs-disabled {opacity: .6;}
.dxi-tabs-title {display: flex;align-items: center;justify-content: center;position: relative;z-index: 2;}
.dxi-tabs-active {transition: all 0.15s ease-in-out;}
.dxi-tabs-slider {position: absolute;left: 0;transition: all 0.15s ease-in-out;z-index: 0;transform: translateZ(0);}
</style>
