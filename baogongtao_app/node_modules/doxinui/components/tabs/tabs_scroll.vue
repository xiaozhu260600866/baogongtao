<template>
	<view class="dxi-tabs" :class="[isFixed?'dxi-tabs-fixed':'dxi-tabs-relative',myclass]" :style="{padding:padding,background:bgColor,height:height*2+'rpx',top:isFixed?top+'px':'auto',zIndex:zIndex}">
		<input class="dx-input" :value="currentValue"  hidden/>
		<scroll-view scroll-x="true" scroll-with-animation :scroll-left="scrollLeft">
			<view class="dxi-tabs-item" :class="[currentTab==index ? 'cur' : '']" @tap.stop="swichTabs(index)"
			 :style="{margin:itemMargin,fontSize:currentTab==index?curSize*2+'rpx' : nameSize*2+'rpx',height:height*2+'rpx',lineHeight:height*2+'rpx',
			 color:currentTab==index?curColor:nameColor,fontWeight:currentTab==index?curBold:nameBold,}"
			 v-for="(item,index) in tabs" :data-current="index" :key="index">
				<text>{{item.name}}</text>
				<text class="Arial" v-if="item.num">({{item.num}})</text>
				<view class="dxi-tabs-border" :style="{background:borderColor,height:borderHeight*2+'rpx',width:borderWidth*2+'rpx',borderRadius:borderRadius*2+'rpx',marginLeft:'-'+borderWidth+'rpx'}" v-if="currentTab==index"></view>
			</view>
		</scroll-view>
	</view>
</template>

<script>
	import dxIcon from "../icon/icon"
	export default{
		components: {
			dxIcon
		},
		props: {
			// 自定义类名
			myclass:{
				type: String, 
				default: ''
			},
			// 数据
			tabs: {
				type: Array,
				default () {
					return []
				}
			},
			// 整体padding
			padding:{
				type:String,
				default:"0 20rpx"
			},
			// 元素margin
			itemMargin:{
				type:String,
				default:"0 30rpx"
			},
			//背景色
			bgColor: {
				type: String,
				default: "#FFFFFF"
			},
			//是否固定
			isFixed: {
				type: Boolean,
				default: false
			},
			//px
			top: {
				type: Number,
				default: 0
			},
			zIndex:{
				type: Number,
				default: 99
			},
			// 高度
			height: {
				type: Number,
				default: 44
			},
			// 字体大小
			nameSize:{
				type:Number,
				default: 13
			},
			// 字体颜色
			nameColor:{
				type: String,
				default: '#666'
			},
			// 字体是否加粗
			nameBold:{
				type: String,
				default: 'normal'
			},
			// 激活字体大小
			curSize:{
				type:Number,
				default: 15
			},
			value: {
				type: String,
				default: ''
			},
			// 激活字体颜色
			curColor:{
				type: String,
				default: '#f56c6c'
			},
			// 激活字体是否加粗
			curBold:{
				type: String,
				default: 'normal'
			},
			// 激活线
			borderColor:{
				type: String,
				default: "#f56c6c"
			},
			borderHeight:{
				type: Number,
				default: 3
			},
			borderRadius:{
				type: Number,
				default: 3
			},
			borderWidth:{
				type: Number,
				default: 34
			}
		},
		data(){
			return {
				currentTab: 0, //预设当前项的值
				scrollLeft: 0 //tab标题的滚动条位置
			}
		},
		computed: {
			currentValue: {
				// 动态计算currentValue的值
				get: function() {
					return this.value;
				},
				set: function(val) {
					this.$emit('input', val);
				}
			}
		},
		watch: {
			currentTab(val) {
				console.log(222,val)
				this.checkCor();
			}
		},
		created() {
			setTimeout(() => {
				// 高度自适应
				uni.getSystemInfo({
					success: (res) => {
						this.winWidth = res.windowWidth;
						this.checkCor()
					}
				});
				let ratio =  100 / this.tabs.length ;
				this.itemWidth = ratio + "%";
				if(this.tabs.length && this.value && !this.init){
					
					this.tabs.forEach((v,key)=>{
						if(this.value == v.value){
							this.currentTab = key;
							this.init = true;
						}
					});
				}
			}, 50);
		},
		methods:{
			
			// 点击标题切换当前页时改变样式
			swichNav: function(e) {
				let cur = e.currentTarget.dataset.current;
				if (this.currentTab == cur) {
					return false;
				} else {
					this.currentTab = cur
				}
				this.checkCor();
			},
			//判断当前滚动超过一屏时，设置tab标题滚动条。
			checkCor: function() {
				console.log(11111111,this.currentTab)
				if (this.currentTab > 3) {
					//这里距离按实际计算
					this.scrollLeft = 300
				} else {
					this.scrollLeft = 0
				}
				
			},
			swichTabs: function(index) {
				let item = this.tabs[index]
				
				console.log(this.currentValue);
				if (item && item.disabled) return;
				if (this.currentTab == index) {
					return false;
				} else {
					this.currentValue = item.value;
					this.currentTab = index;
					this.$emit("change", {
						index: Number(index)
					})
				}
				this.checkCor();
			}
		}
	}
</script>
<style>
.dxi-tabs{display: flex;align-items: center;white-space: nowrap;width: 100%;}
.dxi-tabs-item{display: inline-block;position: relative;}
.dxi-tabs-item .dxi-tabs-border{position: absolute;left: 50%;bottom: 0;}
.dxi-tabs-relative {position: relative;}
.dxi-tabs-fixed {position: fixed;left: 0;}
</style>