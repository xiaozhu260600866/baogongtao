<template>
	<view class="list-container" :class="[isList? 'pro-list-row':'',myclass]">
		<view class="dxi-product-list" :style="{width: isList ? '100%':'calc(50% - 8rpx)'}" v-for="(list,listIndex) of productsData" :key="listIndex" >
			<view class="dxi-product-box" v-for="(item,index) in list.list" :key="index" >
				<view class="dxi-pro-item" :class="[isList?'dxi-flex-list':'']" hover-class="hover" :hover-start-time="150" @click="">
					<image :src="item.pic" @load="handleViewRender" @error="handleViewRender" class="dxi-pro-img" :class="[isList?'dxi-proimg-list':'']" mode="widthFix" />
					<view class="dxi-pro-content">
						<view class="dxi-pro-tit lh-20">{{item.name}}</view>
						<view class="dx-pro-group" :class="[isList? '':'flex-between']">
							<view class="dxi-pro-price lh-22">
								<text class="dxi-sale-price">￥{{item.price}}</text>
								<text class="dxi-unit" v-if="item.unit && showUnit">/{{item.unit}}</text>
								<text class="dxi-factory-price" v-if="!showUnit&&item.factory">￥{{item.factory}}</text>
							</view>
							<view class="dxi-pro-pay lh-16" v-if="item.self_num_">已售{{item.self_num_}}</view>
						</view>
					</view>
				</view>
			</view>
		</view>
	</view>
</template>

<script>
	import dxIcon from "../icon/icon"
	export default{
		components: {
			dxIcon
		},
		props: {
			// 自定义类名
			myclass:{
				type: String, 
				default: ''
			},
			list:{
			    type:Array, //实际请求获取的列表数据
			},
			isList:{
				type:Boolean,
				default: false
			},
			showUnit:{
				type:Boolean,
				default: false
			},
		},
		data() {
			return {
		        productsData:[{list:[]},{list:[]}]  //展示到视图的列表数据
			}
		},
		watch:{
			productsData(val){
				console.log(val)
			}
		},
		methods:{
			init(){
				this.productsData = [{list:[]},{list:[]}];
			    setTimeout(()=>{
			        this.handleViewRender()
			    },0)
			},
			handleViewRender(){
			    const index = this.productsData.reduce((total,current)=>total + current.list.length,0)
				console.log(index)
			    if(index>this.list.length-1) {
			        // 加载完成触发事件并返回加载过的图片数
			        this.$emit('finishLoad',index)
			        return
			    };
			    const query = uni.createSelectorQuery().in(this);
			    let listFlag = 0;

			    query.selectAll('.dxi-product-list').boundingClientRect(data => {
					console.log(data)
					console.log(this.productsData)
			        listFlag = data[0].bottom - data[1].bottom<=0?0:1;
			        this.productsData[listFlag].list.push(this.list[index])
			    }).exec()
			},
		},
		mounted() {
		    if(this.list.length){
		        this.init()
		    }
		}
		
	}
</script>
<style>
.list-container {display: flex;justify-content: space-between;align-items:flex-start;padding: 0 24upx;padding-top: 30upx;}
.pro-list-row{display: block;padding: 0;}
.dxi-product-list {display: flex;flex-direction: column;}
/* .dxi-product-box {flex: 1;margin: 0 16upx;}
.dxi-product-box:last-child {margin-left: 0;} */
.dxi-product-box{}
.dxi-pro-item {width: 100%;margin-bottom: 16upx;background: #fff;box-sizing: border-box;border-radius: 12upx;overflow: hidden;transition: all 0.15s ease-in-out;}
.dxi-flex-list {display: flex;margin-bottom: 1upx !important;border-radius: 0;}
.dxi-pro-img {width: 100%;display: block;}
.dxi-proimg-list {width: 260upx;height: 260upx;flex-shrink: 0;border-radius: 12upx;}
.pro-list-row .dxi-proimg-list{border-radius: 0;}
.dxi-pro-content {display: flex;flex-direction: column;justify-content: space-between;box-sizing: border-box;padding: 20upx;}
.dxi-pro-tit {color: #2e2e2e;font-size: 28upx;word-break: break-all;overflow: hidden;text-overflow: ellipsis;display: -webkit-box;-webkit-box-orient: vertical;-webkit-line-clamp: 2;}
.dx-pro-group {padding-top: 18upx;}
.dxi-sale-price {font-size: 34upx;font-weight: 500;color: #e41f19;}
.dxi-unit {font-size: 24upx;color: #999;padding-left: 12upx;}
.dxi-factory-price {font-size: 24upx;color: #a0a0a0;text-decoration: line-through;padding-left: 12upx;}
.dxi-pro-pay {padding-top: 10upx;font-size: 24upx;color: #999;}
</style>