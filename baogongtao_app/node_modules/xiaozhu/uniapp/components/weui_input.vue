<!-- 调用
//发送验证码
<weui-input v-model="ruleform.code" label="发送验证码" type="sms" name="code" action="/auth/sendSms" :phone="ruleform.username"></weui-input>

//文本(通用)
<weui-input v-model="ruleform.name" label="门店名称" type="text" name="name"></weui-input>
左边带icon
<weui-input  type="text" v-model="ruleform.userPass"  placeholder="请输入密码" myclass="test" >
	<div slot="left">
		<div class="float_l iconfont icon-login-lock" style="padding-right: 30rpx"></div>
	</div>
</weui-input>
只有input 没有label
<weui-input v-model="ruleform.name" type="text"></weui-input>
右边自定义
<weui-input  type="text"  placeholder="请输入姓名" label="姓名">
	<div slot="middle">123</div>
</weui-input>


//上传
 <weui-input v-model="ruleform.logo" label="上传LOGO" type="upload" upurl='article' allowUpLoadNum="1" name="logo" datatype="require"></weui-input>
 //上传单图
 <weui-input v-model="ruleform.logo" label="上传LOGO" type="singleUpload" upurl='article' allowUpLoadNum="1" name="logo" datatype="require"></weui-input>

//select
 <weui-input v-model="ruleform.sendType" name="sendType" datatype="require" label="送货方式" changeField="value" type="select" :data="[
	{label:'普通',value:1},
	{label:'加急',value:2},
	{label:'自提',value:3},
]"></weui-input>

 //日期
 <weui-input v-model="ruleform.date" label="日期" type="date" name="date"></weui-input>

 //textarea
 <weui-input v-model="ruleform.remark" label="门店简介" type="textarea" name="remark"></weui-input>

//checkbox
<weui-input v-model="ruleform.sendType" label="送货方式" name="sendType" changeField="value" type="checkbox" dataKey="sendTypeArr" :radioType="true"></weui-input>
注意必须要在data方法给数组才生效
data(){
	return {
		sendTypeArr:[
			   {label:'普通',value:'普通'},
			   {label:'加急',value:'加急'},
			  {label:'自提',value:'自提'},
		],
		//给的指必须是数组
	}
}

//radio 单选

<weui-input v-model="ruleform.sendType" label="送货方式" name="sendType" changeField="value" type="radio" dataKey="sendTypeArr" :radioType="true"></weui-input>
注意必须要在data方法给数组才生效
data(){
	return {
		sendTypeArr:[
			   {label:'普通',value:'普通'},
			   {label:'加急',value:'加急'},
			  {label:'自提',value:'自提'},
		],
		 //给的指必须是数组
	}
}

//级联选择
<weui-input v-model="ruleform.needArr" label="需求类型" name="needArr"   type="manyselect" :data=":[
	{label:'服务类',value:'0',children:[
		{label:'工商财税法律',value:'12'},
		{label:'咨询管理',value:'2'},
		{label:'数据信息',value:'3'},
		{label:'人力资源',value:'4'},
		{label:'电商营销',value:'5'},
		{label:'医疗健康',value:'6'},
	]},{
	label:'产品类',value:'11',children:[
		{label:'电子电工',value:'7'},
		{label:'五金管材',value:'8'},
		{label:'家电日用',value:'9'},
		{label:'机械设备',value:'10'}
	]}
]" @callback="needCallBack" changeField="value"></weui-input>

ruleform.needArr = [0,0] ;  //数组，默认第一个;
开关
<weui-input v-model="ruleform.radio" label="标题1" type="switch"></weui-input>



 -->
<template>
	<view>
		<!-- 开关 -->
		<view :class="['dx-cell','dx-cell_switch',block?'dx-cell_block':'',myclass]" v-if="type == 'switch'">
			<view class="dx-cell_bd">
				<view class="dx-label" v-if="label"><text class="star" v-if="isRequire">*</text>{{ label }}</view>
			</view>
			<view class="dx-cell_ft">
				<switch class="switch" :color="color" :style="{zoom:zoom?zoom:'74%'}" @change="changeRadio($event)" :checked="currentValue ? true : false"/>
			</view>
		</view>
		<!-- 开关结束 -->
		
		<!-- 定位 -->
		<view :class="['dx-cell','dx-location',block?'dx-cell_block':'',myclass]" v-if="type == 'location'">
			<view class="dx-cell_hd">
				<view class="dx-label" v-if="label">{{ label }}<text class="star" v-if="isRequire">*</text></view>
			</view>
			<view class="dx-cell_bd">
				<input class="dx-input" type="text" @input="updateVal" :placeholder="placeholder?placeholder:'请选择您的位置信息'" :disabled="disabled"
				 :value="currentValue">
			</view>
			<view class="dx-cell_ft">
				<view :class="['dx-nav',navClass?navClass:'dx-btn-green']" @click="changeLocation">定位</view>
			</view>
		</view>
		<!-- 定位结束 -->
		
		<!-- 文本 -->
		<view :class="['dx-cell',block?'dx-cell_block':'',myclass]" v-if="type=='text' || type=='textarea' || type=='password' || type=='number' || type=='digit' || type=='txt'">
			<input class="dx-input" :placeholder="placeholder ? placeholder :'请输入'+label" v-if=" currentValue != undefined"
			 :disabled="disabled" :value="currentValue"  hidden/>
			<view class="dx-cell_hd">
				<slot name="left" />
				<view class="dx-label" v-if="label">{{ label }}<text class="star" v-if="isRequire">*</text></view>
			</view>
			<view class="dx-cell_bd">
				<input class="dx-input" :placeholder="placeholder ? placeholder :'请输入'+label" :placeholder-class="placeholderClass"
				 v-if="type == 'text' && currentValue != undefined" :disabled="disabled" :value="currentValue" :focus="focus" @input="updateVal"
				 :maxlength="maxlength ? maxlength: 100" />
				<input class="dx-input" :placeholder="placeholder ? placeholder :'请输入'+label" v-if="type == 'number' && currentValue != undefined"
				 :disabled="disabled" @input="updateVal" :value="currentValue" :focus="focus" :placeholder-class="placeholderClass" type="number"
				 :maxlength="maxlength ? maxlength: 100" />
				<input class="dx-input" :placeholder="placeholder ? placeholder :'请输入'+label" :placeholder-class="placeholderClass"
				 v-if="type == 'digit' && currentValue != undefined" :disabled="disabled" @input="updateVal" :value="currentValue" :focus="focus"
				 type="digit" :maxlength="maxlength ? maxlength: 100" />
				<input class="dx-input" :placeholder="placeholder ? placeholder :'请输入'+label" :placeholder-class="placeholderClass" type="password"
				 @input="updateVal" :disabled="disabled" v-if="type == 'password' && currentValue != undefined" />
				<textarea maxlength="-1" class="dx-text" :placeholder="placeholder ? placeholder :'请输入'+label" :placeholder-class="placeholderClass"
				 @input="updateVal" v-if="type == 'textarea'" :disabled="disabled" :value="currentValue"/>
				<view class="dx-txt" v-if="type == 'txt'">{{currentValue }}</view>
				<slot name="middle" />
			</view>
			<view class="dx-cell_ft dx_ft-access" v-if="arrow"></view>
			<slot name="right" />
		</view>
		<!-- 文本结束 -->
		
		<!-- 发送验证码 -->
		<view :class="['dx-cell',block?'dx-cell_block':'',myclass]" v-if="type == 'sms'" >
			<view class="dx-cell_hd">
				<slot name="left" />
				<view class="dx-label" v-if="label">{{ label }}<text class="star" v-if="isRequire">*</text></view>
			</view>
			<view class="dx-cell_bd">
				<input class="dx-input" :placeholder="placeholder ? placeholder :'请输入'+label" :disabled="disabled" :focus="focus" @input="bingPhoneCode"/>
				<slot name="middle" />
			</view>
			<view class="dx-cell_ft">
				<view :class="['dx-nav',navClass?navClass:'dx-btn-green']" @click="toSms">{{ smsTitle }}</view>
			</view>
		</view>
		<!-- 发送验证码结束 -->

		<!-- 多选 -->
		<view :class="['dx-cell',myclass,radioType?'radioType':'',block?'dx-cell_block':'']" v-if="type == 'checkbox'">
			<view class="dx-cell_hd">
				<slot name="left" />
				<view class="dx-label" v-if="label">{{ label }}<text class="star" v-if="isRequire">*</text></view>
			</view>
			<view class="dx-cell_bd">
				<checkbox-group class="dx-check_group" @change="checkboxChange" :class="{'row_group':row,'col_group':!row,right:right}">
					<input class="dx-input" :placeholder="placeholder ? placeholder :'请输入'+label" v-if=" currentValue != undefined"
					 :disabled="disabled" :value="currentValue"  hidden/>
					<label class="dx-check_label" :class="{'label_left':Labelleft}" v-for="item in data">
						<view class="dx-checkbox">
							<checkbox :value="changeField == 'value' ? item.value :item.label" :color="color"
							 :style="['transform:scale('+size+')']" v-if="!item.checked"/>
							<checkbox :value="changeField == 'value' ? item.value :item.label" checked="true" :color="color"
							 :style="['transform:scale('+size+')']" v-else/>
						</view>
						<view class="dx-checktxt">{{item.label}}</view>
					</label>
				</checkbox-group>
			</view>
			<slot name="right" />
		</view>
		<!-- 多选结束 -->
		
		<!-- 单选 -->
		<view :class="['dx-cell',block?'dx-cell_block':'',myclass]" v-if="type == 'radio'">
			<view class="dx-cell_hd">
				<slot name="left" />
				<view class="dx-label" v-if="label">{{ label }}<text class="star" v-if="isRequire">*</text></view>
			</view>
			<view class="dx-cell_bd">
				<radio-group class="dx-check_group" @change="radioChange" :class="{'row_group':row,'col_group':!row,right:right}">
					<input class="dx-input" :placeholder="placeholder ? placeholder :'请输入'+label" v-if=" currentValue != undefined"
					 :disabled="disabled" :value="currentValue"  hidden/>
					<label class="dx-check_label" :class="{'label_left':Labelleft}" v-for="(item,key) in data" :key="item.label">
						<view class="dx-checkbox" >
							<!-- 未选中 -->
							<radio :value="changeField == 'value' ? item.value :item.label" :color="color" checked="true" v-if="item.checked"/>
							<radio :value="changeField == 'value' ? item.value :item.label" :color="color" v-else/>
						</view>
						<view class="dx-checktxt">
							<!-- #ifndef MP-WEIXIN -->
							<slot :name="'icon_'+key" />
							<!-- #endif -->
							{{item.label}}
						</view>
					</label>
				</radio-group>
			</view>
			<slot name="right" />
		</view>
		<!-- 单选结束 -->
		
		<!-- select -->
		<view :class="['dx-cell','dx-select',block?'dx-cell_block':'',myclass]" v-if="type == 'select'">
			<view class="dx-cell_hd">
				<slot name="left" />
				<view class="dx-label" v-if="label">{{ label }}<text class="star" v-if="isRequire">*</text></view>
			</view>
			<view class="dx-cell_bd" :class="{left:left}">
				<input class="dx-input" :placeholder="placeholder ? placeholder :'请选择'+label" v-if=" currentValue != undefined"
				 :disabled="disabled" :value="currentValue"  hidden/>
				<div class="dx-label" v-if="disabled">{{ currentValue }}</div>
				<div v-else>
					<picker :value="selectKey" class="order-picker" :range="data" range-key="label" @change="selectRes">
						<view class="picker picker-value" v-if="currentValue">
							{{currentValue}}
						</view>
						<view class="picker picker-label" v-else>
							{{ placeholder ? placeholder : '请选择'+label}}
						</view>
					</picker>
				</div>
			</view>
			<view class="dx-cell_ft dx_ft-access" v-if="!disabled"></view>
			<slot name="right" />
		</view>
		<!-- select结束 -->
		
		<!-- emptyselect -->
		<view :class="['dx-cell','dx-select',block?'dx-cell_block':'',myclass]" v-if="type == 'emptySelect'" @click="toClick">
			<view class="dx-cell_hd">
				<slot name="left" />
				<view class="dx-label" v-if="label">{{ label }}<text class="star" v-if="isRequire">*</text></view>
			</view>
			<view class="dx-cell_bd" :class="{left:left}">
				<input class="dx-input" :placeholder="placeholder ? placeholder :'请选择'+label" v-if=" currentValue != undefined"
				 :disabled="disabled" :value="currentValue"  hidden/>
				<view class="picker picker-value">{{currentValue}}</view>
			</view>
			<view class="dx-cell_ft dx_ft-access" v-if="!disabled"></view>
			<slot name="right" />
		</view>
		<!-- emptyselect结束 -->

		<!-- manyselect -->
		<view :class="['dx-cell','dx-select',block?'dx-cell_block':'',myclass]" v-if="type == 'manyselect'" @click="chooseFclass">
			<input class="dx-input" :placeholder="placeholder ? placeholder :'请输入'+label" v-if=" currentValue != undefined"
			 :disabled="disabled" :value="currentValue"  hidden/>
			<view class="dx-cell_hd">
				<slot name="left" />
				<view class="dx-label" v-if="label">{{ label }}<text class="star" v-if="isRequire">*</text></view>
			</view>
			<view class="dx-cell_bd" :class="{left:left}">
				<view class="picker picker-value" v-if="manyselectValue">
					{{manyselectValue}}
				</view>
				<view class="picker picker-label" v-else>
					{{ placeholder ? placeholder : '请选择'+label}}
				</view>
			</view>
			<view class="dx-cell_ft dx_ft-access" v-if="!disabled"></view>
			<slot name="right" />
		</view>
		<!-- manyselect结束 -->

		<!-- 多张图片上传 -->
		<view :class="['dx-cell','dx-upload_img',block?'dx-cell_block':'',myclass]" v-if="type == 'upload'">
			<input class="dx-input" :placeholder="placeholder ? placeholder :'请输入'+label" v-if=" currentValue != undefined"
			 :disabled="disabled" :value="currentValue"  hidden/>
			<view class="dx-cell_hd" v-if="label">
				<view class="dx-label" v-if="label">{{ label }}<text class="star" v-if="isRequire">*</text></view>
			</view>
			<view class="dx-cell_bd">
				<view :class="['upload-img',block?'dx-cell_block':'',myclass]">
					<view class="uploadvalue" v-if="currentValue && currentValue.length<allowUpLoadNum && !disabled">
						<view class="upload" @click="uploadImage" data-thumbsize="300" :data-upurl="upurl" :data-allowuploadnum="allowUpLoadNum"
						 :data-type="uploadtype">
							<view class="add-icon"></view>
						</view>
					</view>
					<view class="il-item" v-for="(item,index) in currentValue">
						<image :src="loading ? '' :getSiteName+'/upload/images/'+upurl+'/'+item" v-if="currentValue" lazy-load="true" mode="aspectFill"
						 data-name="pic" :class="['img',loading]" @click="largeImage(getSiteName+'/upload/images/'+upurl+'/'+item)"/>
						<view class="del" @click="delImage" data-name="pic" :data-key="index" v-if='!disabled'>
							<view class="del-icon"></view>
						</view>
					</view>
				</view>
				<view class="tips" v-if="tips"><text class="txt">{{ tips }}</text></view>
			</view>
		</view>
		<!-- 多张图片上传结束 -->
		<!-- 多视频上传 -->
		<view :class="['dx-cell','dx-upload_video',block?'dx-cell_block':'',myclass]" v-if="type == 'uploadVideo'">
			<input class="dx-input" :placeholder="placeholder ? placeholder :'请输入'+label" v-if=" currentValue != undefined"
			 :disabled="disabled" :value="currentValue"  hidden/>
			<view class="dx-cell_hd" v-if="label">
				<view class="dx-label" v-if="label">{{ label }}<text class="star" v-if="isRequire">*</text></view>
			</view>
			<view class="dx-cell_bd">
				<view :class="['upload-video',block?'dx-cell_block':'',myclass]">
					<view class="uploadvalue" v-if="currentValue && currentValue.length<allowUpLoadNum && !disabled">
						<view class="upload" @click="uploadVideo" data-thumbsize="300" :data-upurl="upurl" :data-allowuploadnum="allowUpLoadNum"
						 :data-type="uploadtype">
							<view class="iconfont icon-xiaozhu-video"></view>
						</view>
					</view>
					<view class="il-item" v-for="(item,index) in currentValue">
						<view class="video-group" @click="openVideoDiag(item)">
							<image class="cover" :src="getSiteName+'/upload/video/'+upurl+'/'+item.videoCover"  mode="aspectFill"></image>
							<text class="icon iconfont icon-pro-play"></text>
						</view>
						<view class="del" @click="delImage" data-name="pic" :data-key="index" v-if='!disabled'>
							<view class="del-icon"></view>
						</view>
					</view>
				</view>
				<view class="tips" v-if="tips"><text class="txt">{{ tips }}</text></view>
			</view>
		</view>
		
		<!-- 视频弹出层 -->
		<!-- <dx-diag :tbPadding="0" :lrPadding="0" width="100%" myclass="video-diag" ref="videoDiag">
			{{getSiteName+'/upload/video/'+upurl+'/'+videoSrc}}
			<view>连接{{videoSrc}}</view>
			<video class="w-b100" x5-video-player-type="h5" :webkit-playsinline="true" :playsinline="true" :controls="true"  :src="getSiteName+'/upload/video/'+upurl+'/'+videoSrc" v-if="videoSrc"></video>
			<video class="w-b100" :src="getSiteName+'/upload/video/'+upurl+'/'+videoSrc" enable-danmu danmu-btn controls></video>
		</dx-diag> -->
		<div class="video-diag" v-if="videoDiag==true">
			<div class="overlay"></div>
			<div class="video-diag-box">
				<video class="this-video"  v-if="videoDiag2==true" :src="getSiteName+'/upload/video/'+upurl+'/'+videoSrc" enable-danmu danmu-btn controls></video>
				<div class="off-icon btm-off" @click="videoDiag=false;videoDiag2=false"><text class="iconfont icon-xiaozhu-OFF fw-bold"></text></div>
			</div>
		</div>
		<!-- 多视频上传结束 -->
		
		
		<!-- 日期 -->
		<view :class="['dx-cell','dx-dateTime',block?'dx-cell_block':'',myclass]" v-if="type == 'date'">
			<view class="dx-cell_hd">
				<slot name="left" />
				<view class="dx-label" v-if="label">{{ label }}<text class="star" v-if="isRequire">*</text></view>
			</view>
			<view class="dx-cell_bd" :class="{left:left}">
				<picker :value="currentValue" class="date-picker" mode="date" @change="bindDateChange" :start="startDate ||'1980-03-26'"
				 :end="endDate||'2099-12-31'">
					<view class="picker picker-value" v-if="currentValue">
						{{currentValue}}
					</view>
					<view class="picker picker-label" v-else>
						{{ placeholder ? placeholder : '请选择'+label}}
					</view>
				</picker>
			</view>
			<view class="dx-cell_ft dx_ft-access"></view>
			<slot name="right" />
		</view>
		<!-- 日期结束 -->

		<!-- 时间 -->
		<view :class="['dx-cell','dx-dateTime',block?'dx-cell_block':'',myclass]" v-if="type == 'time'">
			<view class="dx-cell_hd">
				<slot name="left" />
				<view class="dx-label" v-if="label">{{ label }}<text class="star" v-if="isRequire">*</text></view>
			</view>
			<view class="dx-cell_bd" :class="{left:left}">
				<picker :value="currentValue" class="date-picker" mode="time" @change="bindTimeChange" :start="startTime || '00:00'" :end="endTime || '23:59'">
					<view class="picker picker-value" v-if="currentValue">
						{{currentValue}}
					</view>
					<view class="picker picker-label" v-else>
						{{ placeholder ? placeholder : '请选择'+label}}
					</view>
				</picker>
			</view>
			<view class="dx-cell_ft dx_ft-access"></view>
			<slot name="right" />
		</view>
		<!-- 时间结束 -->
		
		
		<!-- 多选择层 -->
		<div v-if="condition" class="ms_diag">
			<view class="ms_title">
				<view @click="chooseFclass" class="cancel">取消</view>
				<view @click="comfirm" class="true">确定</view>
			</view>
			<picker-view class="ms_select" :value="selectManyKey" @change="bindChange">
				<picker-view-column>
					<view class="ms_item" v-for="(parent,key) in data" wx:key="item">{{parent.label}}</view>
				</picker-view-column>
				<picker-view-column>
					<view class="ms_item" v-if="data[selectManyKey[0]].children" v-for="(son,key2) in data[selectManyKey[0]].children" wx:key="item">{{son.label}}</view>
				</picker-view-column>
			</picker-view>
		</div>
		<view class="share-overlay" @click="chooseFclass" v-if="condition"></view>
	</view>

</template>
<script>
import dxftButton from "doxinui/components/button/footer-button"
import dxDiag from "doxinui/components/diag/diag"

export default {
	components: {dxftButton,dxDiag},
	props: ['emptyValue','sourceType','startDate','endDate','startTime','endTime','errorMessage','dataKey','value', 'label', 'type', 'upurl', 'allowUpLoadNum', 'myclass', 'disabled', 'placeholder', 'changeField', 'uploadtype', 'name', 'datatype','navClass','tips','focus','phone',"action",'radioType','row','Labelleft','maxlength','arrow','videoTxt','placeholderClass','color','bgColor','zoom','right','size','left','block'],
	data() {
		return {
			getSiteName: this.getSiteName(),
			chooseArr: [],
			data:[],
			chooseValue: '',
			check: false,
			manyselectValue: '',
			condition: false,
			isRequire: false,
			canSend:true,
			selectKey:0,
			selectManyKey:[0,0],
			smsTitle:'发送验证码',
			timer:'',
			videoSrc:'',
			videoDiag: false,
			videoDiag2: false,
		}
	},
	onUnload(){
		clearInterval(this.timer);
	},
	methods: {
		openVideoDiag(item){
			let src = this.getSiteName+'/upload/video/'+this.upurl+'/'+item.filename
			return this.goto("/pages/video/main?videoSrc="+src,1);
			// this.$refs.videoDiag.thisDiag = true;
			this.videoDiag = true;
			setTimeout(()=>{
				this.videoDiag2 = true;
			},300)
			this.videoSrc = item.filename;
		},
		toClick(){
			console.log(1)
			this.$emit('click')
		},
		largeImage(value){
			uni.previewImage({
				current: value, // 当前显示图片的http链接
				urls: [value] // 需要预览的图片http链接列表
			})	
		},
		updateVal(e){
			this.currentValue = e.mp.detail.value;
		},
		bingPhoneCode(e){
			this.currentValue = e.mp.detail.value;
		},
		toSms(){
			setTimeout(()=>{
				var phoneReg = /(^1[3|4|5|7|8|9]\d{9}$)|(^09\d{8}$)/;
				if (!phoneReg.test(this.phone || !this.phone)) {
					this.getError("手机格式不正确");
					return false;
				}
				if(this.canSend){
					this.postAjax(this.action,{phone:this.phone}).then(msg=>{
						if (msg.data.status == 2) {
							this.canSend = false;
							var num = 60;
							uni.setStorageSync('smsCode', msg.data.code);
							this.timer = setInterval(() => {
								num--;
								if (num == 0) {
									clearInterval(this.timer);
									this.canSend = true;
									this.smsTitle = "发送验证码";
								} else {
									this.smsTitle = num + "秒";
								}
							}, 1000)
						}
					});
				}
			},200);
		},
		scrollUploadCallBack(item){
			this.$emit("callBack",item);
		},
		chooseFclass() {
			this.condition = !this.condition;
		},
		changeRadio(event) {
			
			this.currentValue = !this.currentValue;
			this.$emit("callBack",this.currentValue);
		},
		changeLocation() {
			console.log("00954")
			wx.chooseLocation({
				success: msg => {
					this.currentValue = msg.name;
					this.$emit('callback', msg);
				}
			});
		},
		comfirm() {
			this.chooseFclass();
			let parentValue = this.data[this.selectManyKey[0]];
			if (!this.data[this.selectManyKey[0]].children || this.data[this.selectManyKey[0]].children.length == 0) {
				this.selectManyKey.splice(1, 1);
				this.manyselectValue = parentValue.label;
				if(this.changeField == 'label'){
					this.currentValue = parentValue.label;
				}else{
					this.currentValue = parentValue.value;
				}
				
				this.$emit('callback', [parentValue]);
			} else {
				let sonValue = parentValue.children[this.selectManyKey[1]];
				this.manyselectValue = parentValue.label + "-" + sonValue.label;
				if(this.changeField == 'label'){
					this.currentValue = parentValue.label + "," + sonValue.label;
				}else{
					this.currentValue = parentValue.value + "," + sonValue.value;
				}
				
				this.$emit('callback', [parentValue, sonValue]);
			}
		},
		bingInput(e) {
			this.currentValue = e.mp.detail.value;
		},
		selectRes(e) {
			if(this.changeField == 'label'){
				this.currentValue = this.data[e.mp.detail.value].label;
			}else{
				this.currentValue = this.data[e.mp.detail.value].value;
			}
			this.getParent(this).vaildate={};
			this.$emit('callback', this.data[e.mp.detail.value]);
		},
		bindChange(e) {
			if (this.selectManyKey[0] != e.mp.detail.value[0]) {
				this.selectManyKey = [e.mp.detail.value[0], 0];
			} else {
				this.selectManyKey = e.mp.detail.value;
			}
		},
		bindDateChange(e) {
			this.currentValue = e.mp.detail.value;
			this.$emit('callback', this.currentValue);
		},
		bindTimeChange(e){
			this.currentValue = e.mp.detail.value;
		},
		checkboxChange(e) {
			let chooseArr = [];
			this.chooseArr = e.mp.detail.value;
			let parent = this.getParent(this);
			let chooseValue = [];
			parent[this.dataKey].forEach((v, i) => {
				let value = this.changeField == 'label' ? v.label : v.value;
				if (this.in_array(value, this.chooseArr)) {
					this.$set(parent[this.dataKey][i], "checked", true);
				} else {
					this.$set(parent[this.dataKey][i], "checked", false);
				}
				if (v.checked) {
					chooseArr.push(value);
					chooseValue.push(v);
				}
			});
			this.getParent(this).vaildate={};
			this.currentValue = chooseArr;
			this.$emit("checkboxCallBack",chooseValue);
		},
		radioChange(e) {
			this.chooseValue = e.mp.detail.value;
			var chooseData = "";
			let parent = this.getParent(this);
			parent[this.dataKey].forEach((v, i) => {
				if (v.value == this.chooseValue) {
					this.$set(parent[this.dataKey][i], "checked", true);
				} else {
					this.$set(parent[this.dataKey][i], "checked", false);
				}
				if (v.checked) {
					this.chooseValue = v.value;
					chooseData = v;
				}
			});
			this.getParent(this).vaildate={};
			this.$emit("radioCallBack",chooseData);
			this.currentValue = this.chooseValue;
		},
		in_array(value, arr) {
			let res = false;
			if (!arr) return false;
			arr.forEach((v) => {
				if (v == value) {
					res = true;
				}
			});
			return res;
		},
		uploadVideo(event){
			let name = event.mp.currentTarget.dataset.name;
			let upurl = event.mp.currentTarget.dataset.upurl;
			let thumbsize = event.mp.currentTarget.dataset.thumbsize;
			let allowuploadnum = event.mp.currentTarget.dataset.allowuploadnum;
			if (this.currentValue) {
				if (this.currentValue.length >= parseInt(allowuploadnum)) {
					this.getError("只允许上传" + allowuploadnum + "视频");
					return false;
				}
			}
			let uploadUrl = this.getSiteName + '/ajax/app-upload-video';
			uni.chooseVideo({
					count: 1,
					sourceType: ['camera', 'album'],
					success: res=> {
						uni.showLoading({
							title: '视频上传中',
						})
						
						uni.uploadFile({ //上传服务器
							url: uploadUrl, //仅为示例，非真实的接口地址
							thumbsize: 300,
							filePath: res.tempFilePath,
							name: 'file',
							header: {
								//'content-type': 'multipart/form-data'
							},
							formData: {
								'upurl': upurl,
							},
							success: res => {
								uni.hideLoading();
								let data = JSON.parse(res.data);
								let file = data.filename;
								let fileArr = this.currentValue;
								fileArr.push({
									filename:file,
									videoCover:data.videoCover
									
								});
								//if (!this.currentValue) this.currentValue = [];
								this.currentValue=fileArr;
								//this.postAjax("/ajax/image-resize", { type: upurl, value: file, size: [thumbsize] }, msg => {}, this);
								uni.hideLoading();
							},
							fail: function(res) {
						
							},
							complete: function(res) {
						
							}
						})
					}
			 });
		},
		uploadImage(event) {
			let name = event.mp.currentTarget.dataset.name;
			let upurl = event.mp.currentTarget.dataset.upurl;
			let thumbsize = event.mp.currentTarget.dataset.thumbsize;
			let allowuploadnum = event.mp.currentTarget.dataset.allowuploadnum;
			if (this.currentValue) {
				if (this.currentValue.length >= parseInt(allowuploadnum)) {
					this.getError("只允许上传" + allowuploadnum + "图片");
					return false;
				}
			}
			let uploadUrl = this.getSiteName + '/ajax/app-upload-pic';
			let sourceType_=['album', 'camera'];
			if(this.sourceType && this.sourceType == 1){
				sourceType_=['camera'];
			}else if(this.sourceType && this.sourceType == 2){
				sourceType_=['album'];
			}
			uni.chooseImage({
				count: 1, // 默认9
				sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
				sourceType: sourceType_, // 可以指定来源是相册还是相机，默认二者都有
				success: res => {
					var tempFilePaths = res.tempFilePaths;
					uni.showLoading({
						title: '上传中',
					})
					uni.uploadFile({ //上传服务器
						url: uploadUrl, //仅为示例，非真实的接口地址
						thumbsize: 300,
						filePath: tempFilePaths[0],
						name: 'file',
						header: {
							//'content-type': 'multipart/form-data'
						},
						formData: {
							'upurl': upurl,
						},
						success: res => {
							let data = JSON.parse(res.data);
							let file = data.filename;
							let fileArr = this.currentValue;
							fileArr.push(file);
							//if (!this.currentValue) this.currentValue = [];
							this.currentValue=fileArr;
							//this.postAjax("/ajax/image-resize", { type: upurl, value: file, size: [thumbsize] }, msg => {}, this);
							uni.hideLoading();
						},
						fail: function(res) {

						},
						complete: function(res) {

						}
					})
				}
			})
		},
		delImage(event) {
			let name = event.mp.currentTarget.dataset.name;
			let key = event.mp.currentTarget.dataset.key;
			let arr = this.currentValue;
			wx.showModal({
				title: '提示',
				content: "是否真的删除?",
				success: res => {
					if (res.confirm) {
						arr.splice(key, 1);
						this.currentValue = arr;
						console.log(this.currentValue);
					} else if (res.cancel) {

					}
				}
			})
		},
	},
	computed: {
		currentValue: {
			// 动态计算currentValue的值

			get: function() {
				if (this.datatype) {
					if (this.datatype.indexOf('require') != -1 || this.datatype == "array") {
						this.isRequire = true;
					}
				} else {
					this.isRequire = false;
				}
				/*验证规则开始*/
				if(this.type == 'manyselect' && this.name == 'provinces'){
					var parent = this.$parent;
				}else{
					var parent = this.getParent(this);
				}
				if (this.name && this.value == undefined) {
					
					if (this.type == 'upload' && this.allowUpLoadNum > 0  || this.type == 'checkbox' || this.type == 'uploadVideo' && this.allowUpLoadNum > 0) {
					
						this.$set(parent.ruleform, this.name, []);
					} else {
						this.$set(parent.ruleform, this.name, '');
					}

				}
				if (this.datatype && parent.vaildate && parent.vaildate[this.name] == undefined) {
					let label =  this.label ? this.label : this.placeholder;
					this.$set(parent.vaildate, this.name, {
						name:label,
						vaild: this.datatype,
						errorMessage:this.errorMessage || label
					});
				}
				/*验证规则结束*/

				/*如果是多选*/
				if (parent[this.dataKey] && parent[this.dataKey].length && this.type == "checkbox") {
					if (this.name && this.value == undefined) {
						this.value = [];
					}
					if(this.value.length > 0 && !this.check){
						parent[this.dataKey].forEach((v, i) => {
							if (this.in_array(v.value, this.value)) {
								this.$set(parent[this.dataKey][i], "checked", true);
							} else {
								this.$set(parent[this.dataKey][i], "checked", false);
							}
						});
					}
					
					this.data = parent[this.dataKey];
					this.check = true;
				}
				
				/*如果是单选*/
				if (parent[this.dataKey] && parent[this.dataKey].length && (this.type == "radio" || this.type == "radioLists") ) {
					console.log("uab");
					console.log(this.value);
					console.log(this.check);
					if(this.value){
						console.log("uab2");
						parent[this.dataKey].forEach((v, i) => {
							if (v.value == this.value) {
								this.$set(parent[this.dataKey][i], "checked", true);
							} else {
								this.$set(parent[this.dataKey][i], "checked", false);
							}
						});
					}
					console.log(this.dataKey);
					this.data = parent[this.dataKey];
					this.check = true;

				}

				if(this.type == "date" && !this.value && !this.emptyValue){
					this.value = this.dateToString(new Date());
					parent.ruleform[this.name] = this.value;

				}
				if(this.type == "date" && this.value  && this.value.indexOf("中国标准时间")){
					this.value = this.dateToString(new Date(this.value));
					parent.ruleform[this.name] = this.value;
				}
				
				if (this.type == "select" && this.changeField == 'value') {

					this.data = parent[this.dataKey];
					for (var i = 0; i < parent[this.dataKey].length; i++) {
						if (parent[this.dataKey][i].value == this.value) {
							this.selectKey = i;
							return parent[this.dataKey][i].label;
						}
					}
				}

				if (this.type == "select" && this.changeField == 'label') {
					for (var i = 0; i < parent[this.dataKey].length; i++) {
						if (parent[this.dataKey][i].value == this.value) {
							this.selectKey = i;
						}
					}
					this.data = parent[this.dataKey];
				}

				if(this.type == "manyselect"){
					if(this.value){
						let v = this.value.split(",");
						if(v.length > 0 && !this.manyselectValue){
							
							if(v.length ==2){
								
								for (var i = 0; i < parent[this.dataKey].length; i++) {
									if (parent[this.dataKey][i].value == v[0]) {
										this.selectManyKey[0]=i;
										this.manyselectValue = parent[this.dataKey][i].label;
										parent[this.dataKey][i].children.forEach((children,key)=>{
											if(children.value == v[1]){
												this.selectManyKey[1]=key;
												this.manyselectValue += "-"+children.label;
											}
										});
									}
								}
								//this.manyselectValue = this.data[v[0]].label+"->"+this.data[v[0]].children[v[1]].label;
							}else{
								for (var i = 0; i < parent[this.dataKey].length; i++) {
									if (parent[this.dataKey][i].value == v[0]) {
										this.selectManyKey[0]=i;
										this.manyselectValue = parent[this.dataKey][i].label;
									}
								}
							//this.manyselectValue = this.data[v[0]].label;
							}
						}

					}
					this.data = parent[this.dataKey];
				}
				return this.value;
			},
			set: function(val) {
				this.$emit('input', val);
			}
		}
	}
}

</script>

<style scoped="">

@import url("../font/globalFont.css");
@import url("../../css/dx-input.css"); 

</style>